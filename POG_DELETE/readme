POG货架商品删除与双倍陈列（Double Facing）逻辑模块 技术文档
一、模块背景与目标
在POG（Planogram，货架规划图）系统中，为保持货架陈列逻辑的合理性与物理结构一致性，当用户请求删除某个商品（item_code）时，需要综合判断该商品是否：
1. 属于Tray（托盘）上的商品——若商品附属于某个Tray，则不能直接删除。
2. 存在Double Facing逻辑——若允许删除的商品被清除，则应选取销售额（sales）最高的商品进行双倍陈列（Double Facing）填补空位，保证货架完整性与销售最大化。

本模块旨在自动执行这两个逻辑判断与处理过程，输出清晰的处理结果与日志，提升POG数据清理与智能推荐效率。
二、输入文件说明
1. result.csv：主POG文件，包含货架层、位置、商品编码等信息。
2. pog_test_haircare_tray_item.csv：Tray映射表，记录Tray与具体商品的对应关系。
3. sales_item_sum.csv：商品销售数据表，包含销售额与销量。
三、核心逻辑与实现思路
（1）Tray识别逻辑
模块读取主POG文件与Tray映射表。当用户请求删除某个商品item_code时，系统会在Tray表中搜索该商品是否存在于某个Tray上。若存在Tray（例如tray_id=24），则禁止删除该商品。

（2）正常删除逻辑
若该商品不在任何Tray上，系统安全地从result中删除该商品记录。

（3）Double Facing逻辑
见后面具体逻辑

（4）输出结果
输出updated_result.csv（更新后POG数据）与delete_log.csv（删除/禁止删除日志）。
四、日志记录设计
日志文件字段包括：action（操作类型：delete/skip/double）、item_code、tray_id、layer_id、remark（备注说明）。


Double模式逻辑
Double模式用于在某一货架（module）上，根据当前剩余空间与商品销售表现，选择最优商品进行加倍摆放。其核心思想是通过销售额最大化策略，确保在不超出module宽度约束（默认995mm）的前提下，将销售贡献高的商品进行重复陈列。
关键逻辑包括：
1. 读取sales_item_sum.csv，计算每个商品的销售贡献值 = sales × qty。
2. 对每个module（货架）进行遍历，确定其剩余可用宽度（不超过995mm）。
3. 对非tray类商品进行选择，每种至少保留一件。
4. 使用动态规划（0-1背包）算法，在module内分配商品，目标为销售额最大化。
5. 输出每个module的最终摆放方案与销售额提升。
三、动态规划设计
动态规划目标函数：
设共有n个可选商品，每个商品i具有宽度w[i]与销售额v[i]。
货架总宽度为W = 995。
定义状态转移方程：
dp[i][j] = max(dp[i-1][j], dp[i-1][j-w[i]] + v[i])，其中j为当前宽度容量。
通过该递推式，可以在O(nW)复杂度下获得最优摆放方案。
约束条件：
1. 每种商品至少出现一次；
2. 总宽度不超过module实际宽度；
3. 若module宽度略有差异（如995±5mm），统一按995mm计算。
四、系统输入输出
系统输入：
• result.csv：包含货架（module）与商品的基本结构信息。
• pog_test_haircare_tray_item.csv：tray层级信息与商品对应关系。
• sales_item_sum.csv：每个商品的销售额（sales）与销售量（qty）。
系统输出：
• 优化后每个module的最终摆放方案；
• 每个module的销售额提升率；
• 若删除商品时检测到其属于tray商品，则输出“无法删除，位于tray XX上”；
• 若删除商品不存在于result.csv，则输出“未找到商品”

